{% extends 'main/base.html' %}
{% load static %}

{% block title %}Home | Geeza Break{% endblock %}
{% block body_class %}home home-page{% endblock %}

{% block content %}

<!-- Header Section -->
<section class="hero text-center py-5 fade-in section-1">
  <div class="container">
    <h1 class="display-4 hero-headline">
      Supporting Families<br>
      to <span class="highlight">Thrive</span> since<br>
      <span class="hero-year">1992</span>
    </h1>
    <p class="lead">Care in the community, by the community.</p>
  </div>
</section>

<!-- Referral Section Button -->
<section class="section-animate referral-cta-wrap">
  <div class="referral-pill" role="region" aria-labelledby="referralTitle">
    <h2 id="referralTitle" class="mb-0">Complete a referral today</h2>
  <a href="{% url 'main:referral' %}" class="btn btn-referral inner-referral-btn" aria-label="Make a Referral">Make a Referral</a>
  </div>
</section>

<!-- About Geeza Break Section -->
<section class="container py-5 section-animate" id="about">
  <div class="row align-items-center">
    <div class="col-md-6">
      <img src="{% static 'images/thumbnail_LOGO.png' %}" alt="Geeza Break Logo" class="img-fluid mb-3" style="max-width: 300px;">
    </div>
    <div class="col-md-6">
      <h2>About Geeza Break</h2>
      <p>
        Since 1992 Geeza Break has been providing practical and emotional support to children, young people and families. We provide services predominantly in the North East of Glasgow.
        <span id="about-more" style="display:none;">
          Our kinship care service is, however, open to families Glasgow-wide.
          Geeza Break provides a holistic, person and child led service which are both flexible and supportive. Our service is responsive to families’ needs within the North East of Glasgow and encompasses priorities outlined in the Glasgow City Council Family Support Strategy. Building resilience is key for empowering families to be self-reliant, make their own informed choices and reduce dependency for long-term support from statutory services.
          <br>
          Our experienced staff and volunteer team are proficient in supporting families that are experiencing challenging and changing family circumstances. Our aim is to provide early intervention and preventative services focusing on the three cornerstones of GCCHSCP’s Promise Framework for Practice (Voice, Validation, and Hope). This recognises that families are the experts in their own lives.
          <br>
          We aim to develop trusting and non-judgemental relationships with families. With a strength-based approach, our experienced staff and volunteers help families identify and set realistic personal goals. Geeza Break works collaboratively with families to help them achieve these goals, building on and validating their current strengths, assets, and capabilities. By doing this, Geeza Break provide hope that meaningful and sustainable change can be achieved.
        </span>
        <a href="javascript:void(0);" id="about-read-more" style="font-weight:bold;">read more</a>
        <a href="javascript:void(0);" id="about-read-less" style="font-weight:bold; display:none;">read less</a>
      </p>
    </div>
  </div>
</section>

{# Our Impact: two-row polaroid story wall (rope + clothespins) #}
<section class="impact-wall full-width-section" aria-labelledby="impact-title">
  <div class="impact-head">
    <h2 id="impact-title" style="color: black;">Our Impact</h2>
    <p style="font-size: 1.2em; color: black;">"Stories that bind our community — captured on our wall of memories."</p>
  </div>

  <!-- ROW 1 -->
  <div class="rope-row rope-row--top">
    <div class="rope" aria-hidden="true"></div>

    <!-- track is duplicated to create seamless loop -->
    <div class="track" data-speed="32">  {# seconds per loop #}
      <ul class="polaroids">
        {% for item in impact_images %}
        <li class="polaroid">
          <figure>
            <img src="{{ item.src }}" alt="{{ item.alt|default:'Geeza Break moment' }}">
            {% if item.caption %}<figcaption>{{ item.caption }}</figcaption>{% endif %}
          </figure>
          <img class="pin" src="{% static 'img/clothespin.svg' %}" alt="" aria-hidden="true">
        </li>
        {% endfor %}
      </ul>
      <!-- duplicate for seamless loop -->
      <ul class="polaroids" aria-hidden="true">
        {% for item in impact_images %}
        <li class="polaroid" aria-hidden="true">
          <figure>
            <img src="{{ item.src }}" alt="">
            {% if item.caption %}<figcaption>{{ item.caption }}</figcaption>{% endif %}
          </figure>
          <img class="pin" src="{% static 'img/clothespin.svg' %}" alt="">
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- ROW 2 (reverse direction, offset start) -->
  <div class="rope-row rope-row--bottom">
    <div class="rope" aria-hidden="true"></div>

    <div class="track track--reverse" data-speed="38" data-offset="0.35">
      <ul class="polaroids">
        {% for item in impact_images_bottom %}
        <li class="polaroid">
          <figure>
            <img src="{{ item.src }}" alt="{{ item.alt|default:'Geeza Break moment' }}">
            {% if item.caption %}<figcaption>{{ item.caption }}</figcaption>{% endif %}
          </figure>
          <img class="pin" src="{% static 'img/clothespin.svg' %}" alt="" aria-hidden="true">
        </li>
        {% endfor %}
      </ul>
      <ul class="polaroids" aria-hidden="true">
        {% for item in impact_images_bottom %}
        <li class="polaroid" aria-hidden="true">
          <figure>
            <img src="{{ item.src }}" alt="">
            {% if item.caption %}<figcaption>{{ item.caption }}</figcaption>{% endif %}
          </figure>
          <img class="pin" src="{% static 'img/clothespin.svg' %}" alt="">
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</section>

<!-- Hear From the People We've Helped Section -->
<section class="testimonials-section py-5" id="stories">
  <div class="container">
    <h2 class="text-center section-title">Hear from the People We Helped</h2>
    <p class="text-center section-subtitle">Stories of impact from families, carers, and young people</p>

    <!-- Swiper Container -->
    <div class="swiper mySwiper">
      <div class="swiper-wrapper">

        <!-- Testimonial Card -->
        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"The Service is really amazing for the kids. It gave me a bit of time to spend with my eldest son and study for my new college course. Emily was great with both children and has a lot of patience… Emily is a credit to the service."</p>
            <span class="author">— Parent</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"My son has shown more confidence since going out with Michele… The time spent with my son has been invaluable as I am not fit enough at times to do these activities."</p>
            <span class="author">— Parent</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"Trisha was very proactive, and the support given has been great. She spent time researching information and visiting us regularly."</p>
            <span class="author">— Parent</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"Can't fault anyone who has worked with me and my family. Everyone went above and beyond… the fruit & veg at Christmas and fuel vouchers really helped."</p>
            <span class="author">— Caregiver</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"Our son coming to respite has made a huge difference… he is now sleeping in his own bed and getting himself ready… a wake-up call to encourage independence."</p>
            <span class="author">— Parents</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"I look forward to having the service again… helpful for my birth children to have time away… lots of experiences I am unable to provide at the moment."</p>
            <span class="author">— Foster Carer</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"Danielle has been very supportive… emotional wellbeing as well as practical matters like applying for funding… before Danielle's help I didn't see the light at the end of the tunnel."</p>
            <span class="author">— Parent</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"I can't fault the service… my partner and I got time together and the mental break was great… the children loved Zaida and looked forward to going out each week."</p>
            <span class="author">— Parent</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"I had a good time on respite with Zaida… Swimming and Roller-skating… I got to choose what to bake and that was fun."</p>
            <span class="author">— Young Person</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"I had great fun being out with my sister and brother… Michele and Emily did lots of fun things with us… I really enjoyed arts and crafts."</p>
            <span class="author">— Sibling Group</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"Loved going to Jan's and playing with her grandchildren too… enjoyed going to PEEK outdoor play."</p>
            <span class="author">— Young Person</span>
          </div>
        </div>

        <div class="swiper-slide">
          <div class="testimonial-card">
            <p>"Cathie has been amazing… showed me there are nice people out there… helped me learn to trust and speak up… even supported me to get my own bank account."</p>
            <span class="author">— Young Person</span>
          </div>
        </div>

        <!-- Add as many slides as needed -->

      </div>
      <!-- Pagination + Navigation -->
      <div class="swiper-pagination"></div>
      <div class="swiper-button-next"></div>
      <div class="swiper-button-prev"></div>
    </div>
  </div>
</section>

<!-- Comment Section -->
<section id="feedback" class="feedback-section container py-5 section-animate">
  <div class="row">
    <div class="col-md-12">
      <h2 class="text-center mb-4">We Value Your Feedback</h2>
      <form id="commentForm" class="mb-4" onsubmit="submitComment(event)">
        {% csrf_token %}
        <div class="row g-2 justify-content-center">
          <div class="col-md-3 d-flex">
            <input type="text" name="name" id="commentName" class="form-control me-2" placeholder="Your Name">
            <button type="button" class="btn btn-outline-secondary" id="anonymousBtn" tabindex="0">Anonymous</button>
          </div>
          <div class="col-md-6">
            <input type="text" name="message" class="form-control" placeholder="How did you find our service?" required>
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Post Comment</button>
          </div>
        </div>
        <div id="commentMessage" class="text-center mt-2" style="display:none;"></div>
      </form>
      <div id="commentsList">
        {% for comment in comments %}
        <div class="card mb-2">
          <div class="card-body">
            <strong>{{ comment.name }}</strong> <span class="text-muted small">{{ comment.created_at|date:'M d, Y H:i' }}</span>
            <p class="mb-0">{{ comment.message }}</p>
          </div>
        </div>
        {% empty %}
        <p class="text-center text-muted">No comments yet. Be the first to share your experience!</p>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<!-- (Global quick drawer now included in base template) -->

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/comment.js' %}"></script>
<script src="{% static 'js/stories.js' %}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      const readMore = document.getElementById("about-read-more");
      const readLess = document.getElementById("about-read-less");
      const moreSpan = document.getElementById("about-more");
      if (readMore && readLess) {
        readMore.addEventListener("click", function() {
          moreSpan.style.display = "inline";
          readMore.style.display = "none";
          readLess.style.display = "inline";
        });
        readLess.addEventListener("click", function() {
          moreSpan.style.display = "none";
          readMore.style.display = "inline";
          readLess.style.display = "none";
        });
      }
    });

    window.filterGames = function(category) {
      document.querySelectorAll('.game-card').forEach(card => {
        const cat = card.dataset.category;
        card.style.display = (category === 'all' || category === cat) ? 'block' : 'none';
      });
    };

    // Home Quick Drawer behavior (right-side)
    (function(){
      const toggle = document.getElementById('quickDrawerToggle');
      const drawer = document.getElementById('homeQuickDrawer');
      const overlay = document.getElementById('quickDrawerOverlay');
      const closeBtn = drawer?.querySelector('.qd-close-btn');
      if(!toggle || !drawer || !overlay) return;

      let lastFocus = null;

      function openDrawer(){
        lastFocus = document.activeElement;
        drawer.classList.add('active');
        drawer.setAttribute('aria-hidden', 'false');
        overlay.classList.add('show');
        overlay.setAttribute('aria-hidden', 'false');
        toggle.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
        const firstLink = drawer.querySelector('a, button');
        setTimeout(()=> firstLink?.focus(), 30);
      }
      function closeDrawer(){
        drawer.classList.remove('active');
        drawer.setAttribute('aria-hidden', 'true');
        overlay.classList.remove('show');
        overlay.setAttribute('aria-hidden', 'true');
        toggle.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
        if (lastFocus && typeof lastFocus.focus === 'function') lastFocus.focus();
      }

      toggle.addEventListener('click', openDrawer);
      closeBtn?.addEventListener('click', closeDrawer);
      overlay.addEventListener('click', closeDrawer);
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape' && drawer.classList.contains('active')) closeDrawer();
      });
    })();

  </script>
{% endblock %}
