{% extends 'main/base.html' %}
{% load static %}

{% block title %}Home | Geeza Break{% endblock %}
{% block body_class %}home{% endblock %}
{% block content %}
<!-- Header Section -->
<section class="hero text-center py-5 fade-in section-1">
  <div class="container">
    <h1 class="display-4 hero-headline">
      Supporting Families<br>
      to <span class="highlight">Thrive</span> since<br>
      <span class="hero-year">1992</span>
    </h1>
    <p class="lead">Care in the community, by the community.</p>
  </div>
</section>

<!-- Referral Section Button -->
<section class="section-animate referral-cta-wrap">
  <div class="referral-pill" role="region" aria-labelledby="referralTitle">
    <h2 id="referralTitle" class="mb-0">Complete a referral today</h2>
  <a href="{% url 'main:referral' %}" class="btn btn-referral inner-referral-btn" aria-label="Make a Referral">Make a Referral</a>
  </div>
</section>

<!-- About Geeza Break Section -->
<section class="container py-5 section-animate" id="about" style="background-color: #d0f4de">
  <div class="row align-items-center">
    <div class="col-md-6">
      <img src="{% static 'images/thumbnail_LOGO.png' %}" alt="Geeza Break Logo" class="img-fluid mb-3" style="max-width: 300px;">
    </div>
    <div class="col-md-6">
      <h2>About Geeza Break</h2>
      <p>
        Since 1992 Geeza Break has been providing practical and emotional support to children, young people and families. We provide services predominantly in the North East of Glasgow.
        <span id="about-more" style="display:none;">
          Our kinship care service is, however, open to families Glasgow-wide.
          Geeza Break provides a holistic, person and child led service which are both flexible and supportive. Our service is responsive to families’ needs within the North East of Glasgow and encompasses priorities outlined in the Glasgow City Council Family Support Strategy. Building resilience is key for empowering families to be self-reliant, make their own informed choices and reduce dependency for long-term support from statutory services.
          <br>
          Our experienced staff and volunteer team are proficient in supporting families that are experiencing challenging and changing family circumstances. Our aim is to provide early intervention and preventative services focusing on the three cornerstones of GCCHSCP’s Promise Framework for Practice (Voice, Validation, and Hope). This recognises that families are the experts in their own lives.
          <br>
          We aim to develop trusting and non-judgemental relationships with families. With a strength-based approach, our experienced staff and volunteers help families identify and set realistic personal goals. Geeza Break works collaboratively with families to help them achieve these goals, building on and validating their current strengths, assets, and capabilities. By doing this, Geeza Break provide hope that meaningful and sustainable change can be achieved.
        </span>
        <a href="javascript:void(0);" id="about-read-more" style="font-weight:bold;">read more</a>
        <a href="javascript:void(0);" id="about-read-less" style="font-weight:bold; display:none;">read less</a>
      </p>
    </div>
  </div>
</section>

{# Our Impact: two-row polaroid story wall (rope + clothespins) #}
<section class="impact-wall full-width-section" aria-labelledby="impact-title">
  <div class="impact-head">
    <h2 id="impact-title">Our Impact</h2>
    <p>Moments from our community — strung up on our story wall.</p>
  </div>

  <!-- ROW 1 -->
  <div class="rope-row rope-row--top">
    <div class="rope" aria-hidden="true"></div>

    <!-- track is duplicated to create seamless loop -->
    <div class="track" data-speed="32">  {# seconds per loop #}
      <ul class="polaroids">
        {% for item in impact_images %}
        <li class="polaroid">
          <figure>
            <img src="{{ item.src }}" alt="{{ item.alt|default:'Geeza Break moment' }}">
            {% if item.caption %}<figcaption>{{ item.caption }}</figcaption>{% endif %}
          </figure>
          <img class="pin" src="{% static 'img/clothespin.svg' %}" alt="" aria-hidden="true">
        </li>
        {% endfor %}
      </ul>
      <!-- duplicate for seamless loop -->
      <ul class="polaroids" aria-hidden="true">
        {% for item in impact_images %}
        <li class="polaroid" aria-hidden="true">
          <figure>
            <img src="{{ item.src }}" alt="">
            {% if item.caption %}<figcaption>{{ item.caption }}</figcaption>{% endif %}
          </figure>
          <img class="pin" src="{% static 'img/clothespin.svg' %}" alt="">
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <!-- ROW 2 (reverse direction, offset start) -->
  <div class="rope-row rope-row--bottom">
    <div class="rope" aria-hidden="true"></div>

    <div class="track track--reverse" data-speed="38" data-offset="0.35">
      <ul class="polaroids">
        {% for item in impact_images_bottom %}
        <li class="polaroid">
          <figure>
            <img src="{{ item.src }}" alt="{{ item.alt|default:'Geeza Break moment' }}">
            {% if item.caption %}<figcaption>{{ item.caption }}</figcaption>{% endif %}
          </figure>
          <img class="pin" src="{% static 'img/clothespin.svg' %}" alt="" aria-hidden="true">
        </li>
        {% endfor %}
      </ul>
      <ul class="polaroids" aria-hidden="true">
        {% for item in impact_images_bottom %}
        <li class="polaroid" aria-hidden="true">
          <figure>
            <img src="{{ item.src }}" alt="">
            {% if item.caption %}<figcaption>{{ item.caption }}</figcaption>{% endif %}
          </figure>
          <img class="pin" src="{% static 'img/clothespin.svg' %}" alt="">
        </li>
        {% endfor %}
      </ul>
    </div>
  </div>
</section>

<!-- Testimonials (updated styling) -->
<section class="testimonials reveal" id="testimonials">
  <h2>Testimonials</h2>
  <blockquote class="reveal">“Geeza Break helped us when we felt hopeless. Their care and consistency changed everything.”<br><span>– Lisa</span></blockquote>
  <blockquote class="reveal">“I never thought I’d get support like this. They’re truly a blessing to families.”<br><span>– Ahmed</span></blockquote>
</section>

<!-- Comment Section -->
<section class="container py-5 section-animate" style="background-color: #ffffff;">
  <div class="row">
    <div class="col-md-12">
      <h2 class="text-center mb-4">We Value Your Feedback</h2>
      <form id="commentForm" class="mb-4" onsubmit="submitComment(event)">
        {% csrf_token %}
        <div class="row g-2 justify-content-center">
          <div class="col-md-3 d-flex">
            <input type="text" name="name" id="commentName" class="form-control me-2" placeholder="Your Name">
            <button type="button" class="btn btn-outline-secondary" id="anonymousBtn" tabindex="0">Anonymous</button>
          </div>
          <div class="col-md-6">
            <input type="text" name="message" class="form-control" placeholder="How did you find our service?" required>
          </div>
          <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Post Comment</button>
          </div>
        </div>
        <div id="commentMessage" class="text-center mt-2" style="display:none;"></div>
      </form>
      <div id="commentsList">
        {% for comment in comments %}
        <div class="card mb-2">
          <div class="card-body">
            <strong>{{ comment.name }}</strong> <span class="text-muted small">{{ comment.created_at|date:'M d, Y H:i' }}</span>
            <p class="mb-0">{{ comment.message }}</p>
          </div>
        </div>
        {% empty %}
        <p class="text-center text-muted">No comments yet. Be the first to share your experience!</p>
        {% endfor %}
      </div>
    </div>
  </div>
</section>

<!-- (Global quick drawer now included in base template) -->

{% endblock %}

{% block extra_scripts %}
<script src="{% static 'js/comment.js' %}"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
      const readMore = document.getElementById("about-read-more");
      const readLess = document.getElementById("about-read-less");
      const moreSpan = document.getElementById("about-more");
      if (readMore && readLess) {
        readMore.addEventListener("click", function() {
          moreSpan.style.display = "inline";
          readMore.style.display = "none";
          readLess.style.display = "inline";
        });
        readLess.addEventListener("click", function() {
          moreSpan.style.display = "none";
          readMore.style.display = "inline";
          readLess.style.display = "none";
        });
      }
    });

    window.filterGames = function(category) {
      document.querySelectorAll('.game-card').forEach(card => {
        const cat = card.dataset.category;
        card.style.display = (category === 'all' || category === cat) ? 'block' : 'none';
      });
    };

    // Home Quick Drawer behavior (right-side)
    (function(){
      const toggle = document.getElementById('quickDrawerToggle');
      const drawer = document.getElementById('homeQuickDrawer');
      const overlay = document.getElementById('quickDrawerOverlay');
      const closeBtn = drawer?.querySelector('.qd-close-btn');
      if(!toggle || !drawer || !overlay) return;

      let lastFocus = null;

      function openDrawer(){
        lastFocus = document.activeElement;
        drawer.classList.add('active');
        drawer.setAttribute('aria-hidden', 'false');
        overlay.classList.add('show');
        overlay.setAttribute('aria-hidden', 'false');
        toggle.setAttribute('aria-expanded', 'true');
        document.body.style.overflow = 'hidden';
        const firstLink = drawer.querySelector('a, button');
        setTimeout(()=> firstLink?.focus(), 30);
      }
      function closeDrawer(){
        drawer.classList.remove('active');
        drawer.setAttribute('aria-hidden', 'true');
        overlay.classList.remove('show');
        overlay.setAttribute('aria-hidden', 'true');
        toggle.setAttribute('aria-expanded', 'false');
        document.body.style.overflow = '';
        if (lastFocus && typeof lastFocus.focus === 'function') lastFocus.focus();
      }

      toggle.addEventListener('click', openDrawer);
      closeBtn?.addEventListener('click', closeDrawer);
      overlay.addEventListener('click', closeDrawer);
      document.addEventListener('keydown', (e)=>{
        if(e.key === 'Escape' && drawer.classList.contains('active')) closeDrawer();
      });
    })();

  </script>
{% endblock %}
